<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <script type="text/javascript" src="https://rawgit.com/mourner/suncalc/master/suncalc.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/jquery-ui.min.js" type="text/javascript"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Sunrisesunset by j0nes2k</title>

    <link rel="stylesheet" type="text/css" media="screen" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.0/themes/base/jquery-ui.css" />
    <style>
      body {
        margin: 0; padding: 0;
        font-family: Arial, sans-serif;
        font-size: 15px;
        line-height: 25px;
        color: #515151;
      }
      article, aside, figcaption, figure, footer, header, hgroup, nav, section {display: block;}
      h1, h2, h3, h4 {margin: 1em 0 .5em; line-height: 1.25;}
      h1 {font-size: 2em;}
      h2 {font-size: 1.5em;}
      h3 {font-size: 1.2em;}
      ul, ol {margin: 1em 0; padding-left: 40px;}
      p, figure {margin: 1em 0;}
      a img {border: none;}
      sup, sub {line-height: 0;}

      #maps-location-search {
        width:500px;
      }

      #maps-location-search {
        width:500px;
      }
      #latitude {
        width:150px;
      }
      #longitude {
        width:150px;
      }
      .form {
        width:800px;
      }
      .form input {
        height: 20px;
      }
      .field {
        margin: 10px 0;
      }
      .error {
        color:red;
      }

      #highcharts {
        width:800px;
        height:400px;
        padding: 20px;
      }
    </style>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Sunrisesunset</h1>
          <h2>See dynamic graphs of sunrise and sunset for all locations worldwide in real-time.</h2>
        </header>
        <hr>

        <section id="main_content">
          <h3>Select your location</h3>
          <form id="formMap" class="form" style="">
            <div class="field">
              <strong>Find Location: </strong>
              <input placeholder="Enter address or name of location to find on map" id="maps-location-search" type="text">
            </div>
            <div class="field">
              <strong>Marker Coordinates: </strong>
              <input type="text" id="latitude" value="54.10"> , <input type="text" id="longitude" value="10.28">
              <button type="button"onclick="clearMap();">Clear Coordinates</button>
            </div>
            <div class="element-map" id="gmaps-canvas" class="field" style="clear: both;height:400px;">
            </div>
            <div id="gmaps-error" class="error"></div>
          </form>

          <div id="highcharts"></div>

        </section>
        <footer>
          Sunrisesunset is maintained by <a href="https://github.com/j0nes2k">j0nes2k</a><br>
          It features the <a href="https://github.com/mourner/suncalc">Suncalc Library</a> from @mourner, the <a href="https://github.com/rollinsw/Google-Maps-Location-Picker">Google Maps Location Picer</a> from @rollinsw and <a href="http://www.highcharts.com">Highcharts</a>.<br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>


      </div>
    </div>
    <script>
      var geocoder;
      var map;
      var marker;
      var formName = 'formMap';
      var formLatitudeField = 'latitude';
      var formLongitudeField = 'longitude';
      var formSearchLocation = 'maps-location-search';
      var formErrorText = 'gmaps-error';
      var existingLat;
      var existingLng;

      var suncalc_data_sunrise = [];
      var suncalc_data_sunset = [];
      var chart;

      var initLatLng = new google.maps.LatLng(54.10, 10.28);

      // Initialize Google Maps
      function initialize_google_maps(){

        // If no lat/lng values, center the map marker on 0,0 coordinates
        if (existingLat == null) {
          var latlng = initLatLng;
          var zoomLevel = 3;
        } else {
          var latlng = new google.maps.LatLng(existingLat,existingLng,true);
          var zoomLevel = 12;
        }

        // Set the options for the map
        var options = {
          zoom: zoomLevel,
          center: latlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        // Create the Google Maps Object
        map = new google.maps.Map(document.getElementById("gmaps-canvas"), options);

        // Create Google Geocode Object that will let us do lat/lng lookups based on address or location name
        geocoder = new google.maps.Geocoder();

        // Add marker. Set draggable to TRUE to allow it to be moved around the map
        marker = new google.maps.Marker({
          map: map,
          draggable: true,
          position: latlng
        });

        // Listen for event when marker is dragged and dropped
        google.maps.event.addListener(marker, 'dragend', function() {
          update_ui('', marker.getPosition(), true);
          $('#' + formErrorText).html('');
        });

        // Listen for event when marker is dropped (map clicked)
        google.maps.event.addListener(map, 'click', function(event) {
            marker.setPosition(event.latLng);
            update_ui(event.latLng.lat() + ', ' + event.latLng.lng(), event.latLng, true);
            $('#' + formErrorText).html('');
        });

        // Listen for map zoom changing
        google.maps.event.addListener(map, 'zoom_changed', function() {
          zoomChangeBoundsListener =
              google.maps.event.addListener(map, 'bounds_changed', function(event) {
                  if (this.getZoom() > 15 && this.initialZoom == true) {
                      // Change max/min zoom here
                      this.setZoom(15);
                      this.initialZoom = false;
                  }
              google.maps.event.removeListener(zoomChangeBoundsListener);
          });
        });

        map.initialZoom = true;

      }

      // Moves the map marker to a given lat/lng and centers the map on that location
      function update_map( geometry ) {
        marker.setPosition(geometry.location);
        map.fitBounds(geometry.viewport);
      }

      // Updates form fields with address and/or lat/lng info
      function update_ui( address, latLng, plot ) {
        $('#' + formSearchLocation).autocomplete("close");

        // If we are plotting a point with the marker, we need to clear out
        // any text in location search.
        if (plot){
          $('#' + formSearchLocation).val('');
        }


          oFormObject = document.forms[formName];
        oFormLat = oFormObject.elements[formLatitudeField].value = latLng.lat();
        oFormLng = oFormObject.elements[formLongitudeField].value = latLng.lng();

        suncalc_update(latLng.lat(), latLng.lng());

      }

      // Query the Google geocode object
      //
      // type: 'address' for search by address
      //       'latLng'  for search by latLng (reverse lookup)
      //
      // value: search query
      //
      // update: should we update the map (center map and position marker)?
      function geocode_lookup( type, value, update ) {
        // default value: update = false
        update = typeof update !== 'undefined' ? update : false;

        request = {};
        request[type] = value;

        geocoder.geocode(request, function(results, status) {
          $('#' + formErrorText).html('');
          if (status == google.maps.GeocoderStatus.OK) {
            // Google geocoding has succeeded!
            if (results[0]) {
              // Always update the UI elements with new location data
              update_ui( results[0].formatted_address,
                         results[0].geometry.location,
                         false )

              // Only update the map (position marker and center map) if requested
              if( update ) { update_map( results[0].geometry ) }
            } else {
              // Geocoder status ok but no results!?
              $('#' + formErrorText).html("Sorry, something went wrong. Try again!");
            }
          } else {
            // Google Geocoding has failed. Two common reasons:
            //   * Address not recognised (e.g. search for 'zxxzcxczxcx')
            //   * Location doesn't map to address (e.g. click in middle of Atlantic)

            if( type == 'address' ) {
              // User has typed in an address which we can't geocode to a location
              $('#' + formErrorText).html("Google could not find " + value + ". Try a different search term, or click the map to manually select a location." );
            }
          };
        });
      };

      function suncalc_update(latitude, longitude) {

        // clear previous data
        suncalc_data_sunrise.length = 0;
        suncalc_data_sunset.length = 0;

        var start = new Date("2014-01-01");
        var end = new Date("2014-12-31");

        while(start < end){

           var newDate = start.setDate(start.getDate() + 1);
           start = new Date(newDate);
           var times = SunCalc.getTimes(start, latitude,  longitude);

           //console.log(start + ":" + times.sunrise.getHours() + ':' + times.sunrise.getMinutes() + " - " + times.sunset.getHours() + ':' + times.sunset.getMinutes());

           suncalc_data_sunrise.push(Date.UTC(0,0,0,times.sunrise.getHours(), times.sunrise.getMinutes(), 0));
           suncalc_data_sunset.push(Date.UTC(0,0,0,times.sunset.getHours(), times.sunset.getMinutes(), 0));

        }

       if (chart !== undefined) {
          chart.series[0].setData(suncalc_data_sunrise,true);
          chart.series[1].setData(suncalc_data_sunset,true);
       }
      }






      $(document).ready(function() {

        if( $('#gmaps-canvas').length  ) {


          initialize_google_maps();

          $('#' + formSearchLocation).autocomplete({

            // source is the list of input options shown in the autocomplete dropdown.
            // see documentation: http://jqueryui.com/demos/autocomplete/
            source: function(request,response) {

              // the geocode method takes an address or LatLng to search for
              // and a callback function which should process the results into
              // a format accepted by jqueryUI autocomplete
              geocoder.geocode( {'address': request.term }, function(results, status) {
                response($.map(results, function(item) {
                  return {
                    label: item.formatted_address, // appears in dropdown box
                    value: item.formatted_address, // inserted into input element when selected
                    geocode: item                  // all geocode data
                  }
                }));
              })
            },

            // event triggered when drop-down option selected
            select: function(event,ui){
              update_ui(  ui.item.value, ui.item.geocode.geometry.location )
              update_map( ui.item.geocode.geometry )
            }

          });

          // triggered when user presses a key in the address box
            $('#' + formSearchLocation).bind('keydown', function(event) {
              if(event.keyCode == 13) {
                geocode_lookup( 'address', $('#' + formSearchLocation).val(), true );

                // ensures dropdown disappears when enter is pressed
                $('#' + formSearchLocation).autocomplete("disable")
              } else {
                // re-enable if previously disabled above
                $('#' + formSearchLocation).autocomplete("enable")
              }
            });



        };

        suncalc_update(initLatLng.lat(),initLatLng.lng());

        $("#highcharts").highcharts({
          chart: {
              type: 'line',
              events: {
                load: function() {
                    chart = this; // `this` is the reference to the chart
                }
              }
          },
          title: {
              text: 'Sunrise and Sunset times'
          },
          xAxis: {
              type: 'datetime',
              minRange: 365 * 24 * 3600000, // 1 year
              dateTimeLabelFormats: {
                month: '%d.%b'
              }
          },
          yAxis: {
              title: "Times",
              type: 'datetime',
              maxPadding: 0.0,
              dateTimeLabelFormats: { //force all formats to be hour:minute:second
                  second: '%H:%M',
                  minute: '%H:%M',
                  hour: '%H:%M',
                  day: '%H:%M',
                  week: '%H:%M',
                  month: '%H:%M',
                  year: '%H:%M'
              }
          },
          series: [{
              data: suncalc_data_sunrise,
              name: "Sunrise",
              pointStart: Date.UTC(2014, 0, 1),
              pointInterval: 3600 * 1000 * 24 // one day
          },
          {
              data: suncalc_data_sunset,
              name: "Sunset",
              pointStart: Date.UTC(2014, 0, 1),
              pointInterval: 3600 * 1000 * 24 // one day
          }],
          tooltip: {
              formatter: function() {
                  return '<b>' + this.series.name + '</b><br>Day of month: ' + Highcharts.dateFormat('%d.%b', this.x) + '<br/>' + this.series.name + ': '+ Highcharts.dateFormat('%H:%M', this.y);
              }
          }


        });

        // chart = Highcharts.Chart({
        //   chart: {
        //       type: 'line',
        //       renderTo: '#highcharts',
        //       // events: {
        //       //   load: function() {
        //       //       chart = this; // `this` is the reference to the chart
        //       //   }
        //       // }
        //   },
        //   title: {
        //       text: 'Sunrise and Sunset times'
        //   },
        //   xAxis: {
        //       type: 'datetime',
        //       minRange: 14 * 24 * 3600000 // fourteen days
        //   },
        //   yAxis: {
        //       title: "Times"
        //       //type: 'line', //y-axis will be in milliseconds
        //       // dateTimeLabelFormats: { //force all formats to be hour:minute:second
        //       //     second: '%H:%M:%S',
        //       //     minute: '%H:%M:%S',
        //       //     hour: '%H:%M:%S',
        //       //     day: '%H:%M:%S',
        //       //     week: '%H:%M:%S',
        //       //     month: '%H:%M:%S',
        //       //     year: '%H:%M:%S'
        //       // }
        //   },
        //   series: [{
        //       //data: suncalc_data_sunrise,
        //       //data: [Date.UTC(2014, 0, 1), Date.UTC(2014, 0, 2)],
        //       data: [1,3,4,5],
        //       name: "Sunrise",
        //       pointStart: Date.UTC(2014, 0, 1),
        //       pointInterval: 3600 * 1000 * 24 // one day
        //   },
        //   {
        //       //data: suncalc_data_sunset,
        //       //data: [Date.UTC(2014, 0, 1), Date.UTC(2014, 0, 2)],
        //       data: [2,5,6,3],
        //       name: "Sunset",
        //       pointStart: Date.UTC(2014, 0, 1),
        //       pointInterval: 3600 * 1000 * 24 // one day
        //   }]

        // });

      });

      function clearMap() {

        $('#' + formLatitudeField).val(null);
        $('#' + formLongitudeField).val(null);
        $('#' + formSearchLocation).val(null);
        $('#' + formErrorText).html('');

        var latLng = new google.maps.LatLng(0,0);
          var bounds = new google.maps.LatLngBounds(latLng);

        marker.setPosition(latLng);
        map.setZoom(1);
      }
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57993803-1', 'auto');
      ga('send', 'pageview');

    </script>
    
  </body>
</html>